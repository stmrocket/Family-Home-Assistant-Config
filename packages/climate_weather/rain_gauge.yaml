sensor:
  - platform: template
    sensors:
      rain_minute:
        unique_id: eec793d1-bca4-4b04-be5a-f09d760aab78
        value_template: "{{ (states('input_number.rain_minute') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_hour:
        unique_id: e79363c4-ba6d-42e3-a612-880ded71e5e0
        value_template: "{{ (states('input_number.rain_hour') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_day:
        unique_id: e61f8421-0479-4885-a237-6863f6d4ffb9
        value_template: "{{ (states('input_number.rain_day') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_week:
        unique_id: b637f6dc-37d9-4493-939a-44fa67ae80c5
        value_template: "{{ (states('input_number.rain_week') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_month:
        unique_id: 29407190-6408-49f8-9dbe-18c07791c03f
        value_template: "{{ (states('input_number.rain_month') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_month_1:
        unique_id: 8cd77f7b-588d-467f-a66d-1de010b3592d
        value_template: "{{ (states('input_number.rain_month_1') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_month_2:
        unique_id: ab292434-0815-41d2-921a-2f9939e8ac72
        value_template: "{{ (states('input_number.rain_month_2') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_month_3:
        unique_id: 38dd0931-9281-4714-945a-5a62641c3a01
        value_template: "{{ (states('input_number.rain_month_3') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_month_4:
        unique_id: c005b8f3-c3c3-479d-8335-d1544b943d8f
        value_template: "{{ (states('input_number.rain_month_4') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_month_5:
        unique_id: 38db3a36-1908-41de-8250-cd02e90803a7
        value_template: "{{ (states('input_number.rain_month_5') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_month_6:
        unique_id: 8f1aee17-2895-49d4-9ff4-20129426e903
        value_template: "{{ (states('input_number.rain_month_6') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_month_7:
        unique_id: 02559903-7bc1-4150-9a3e-83bd3d41b95f
        value_template: "{{ (states('input_number.rain_month_7') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_month_8:
        unique_id: 8a19ceec-5012-4b2d-bff2-db374c1b4297
        value_template: "{{ (states('input_number.rain_month_8') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_month_9:
        unique_id: 572df076-c152-44a3-ac8b-468c9317481e
        value_template: "{{ (states('input_number.rain_month_9') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_month_10:
        unique_id: 140da606-4a15-4819-b9ca-cd94b856cf51
        value_template: "{{ (states('input_number.rain_month_10') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_month_11:
        unique_id: 2c1d08fa-cbe6-4d4f-8810-11e2c2fb4c3b
        value_template: "{{ (states('input_number.rain_month_11') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_month_12:
        unique_id: bbce7c80-f8ea-4a38-834f-5cc97b459eb1
        value_template: "{{ (states('input_number.rain_month_12') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_year:
        unique_id: c05bc2c3-de4b-40c7-bb97-6b3e1f5c9349
        value_template: "{{ (states('input_number.rain_year') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_total:
        unique_id: 682df71e-a617-4a3e-b9b4-841474cd897a
        value_template: "{{ (states('input_number.rain_total') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_minute:
        unique_id: 3cda9e5c-aecd-4ed9-9702-5acb45f215b9
        value_template: "{{ (states('input_number.rain_last_minute') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_hour:
        unique_id: d9553ed0-01d5-49d3-835a-eabad1e2b834
        value_template: "{{ (states('input_number.rain_last_hour') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_day:
        unique_id: 6102ddd1-b9b8-42b4-bf5c-e90cee80b92c
        value_template: "{{ (states('input_number.rain_last_day') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_week:
        unique_id: 051b8e80-94bb-478c-82a1-4a0f89220a47
        value_template: "{{ (states('input_number.rain_last_week') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_month:
        unique_id: e783ba2b-065a-4a95-822f-3076965652af
        value_template: "{{ (states('input_number.rain_last_month') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_month_1:
        unique_id: fba7560d-9e27-45c1-bf41-608550ac26f5
        value_template: "{{ (states('input_number.rain_last_month_1') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_month_2:
        unique_id: 1b0b0ac0-2f81-4a4c-8888-e889aabd74cb
        value_template: "{{ (states('input_number.rain_last_month_2') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_month_3:
        unique_id: 1e710a4e-e94e-44cc-b45a-61a76407edb3
        value_template: "{{ (states('input_number.rain_last_month_3') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_month_4:
        unique_id: 7ed528db-4f9c-4f5d-b5e0-2afbafae2407
        value_template: "{{ (states('input_number.rain_last_month_4') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_month_5:
        unique_id: eb2eb824-c28d-4ad4-a594-7685182dd5be
        value_template: "{{ (states('input_number.rain_last_month_5') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_month_6:
        unique_id: 8fb27a46-3ea7-4f58-b811-cf473d1a7cdf
        value_template: "{{ (states('input_number.rain_last_month_6') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_month_7:
        unique_id: 144f4db6-924e-4c85-8aa6-9529d7d8d4eb
        value_template: "{{ (states('input_number.rain_last_month_7') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_month_8:
        unique_id: 0b480418-bf5f-4ae2-bffe-14a95b6ca744
        value_template: "{{ (states('input_number.rain_last_month_8') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_month_9:
        unique_id: 0d2b501d-9bf0-4aae-8e6c-0c04f0c05b81
        value_template: "{{ (states('input_number.rain_last_month_9') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_month_10:
        unique_id: adc80071-ec3b-4c90-bcd1-ffbbc0d4e11e
        value_template: "{{ (states('input_number.rain_last_month_10') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_month_11:
        unique_id: 2fbccd55-0e12-45a7-bad7-14f354a6a78e
        value_template: "{{ (states('input_number.rain_last_month_11') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_month_12:
        unique_id: dbfa1427-753d-47ed-b497-615e501d5daa
        value_template: "{{ (states('input_number.rain_last_month_12') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"

      rain_last_year:
        unique_id: 80782faf-2098-4e30-992e-8f9ede7ae048
        value_template: "{{ (states('input_number.rain_last_year') | float(none) / 25.4) | round(2, default=none) }}"
        unit_of_measurement: "in"


      rain_rate:
        unique_id: dd620fcd-9c9e-4dd2-a602-2571a7a9bec9
        value_template: >
          {{ (states('input_number.rain_minute_00') | float(none) +
             states('input_number.rain_minute_01') | float(none) +
             states('input_number.rain_minute_02') | float(none) +
             states('input_number.rain_minute_03') | float(none) +
             states('input_number.rain_minute_04') | float(none) +
             states('input_number.rain_minute_05') | float(none) +
             states('input_number.rain_minute_06') | float(none) +
             states('input_number.rain_minute_07') | float(none) +
             states('input_number.rain_minute_08') | float(none) +
             states('input_number.rain_minute_09') | float(none) +
             states('input_number.rain_minute_10') | float(none) +
             states('input_number.rain_minute_11') | float(none) +
             states('input_number.rain_minute_12') | float(none) +
             states('input_number.rain_minute_13') | float(none) +
             states('input_number.rain_minute_14') | float(none) +
             states('input_number.rain_minute_15') | float(none) +
             states('input_number.rain_minute_16') | float(none) +
             states('input_number.rain_minute_17') | float(none) +
             states('input_number.rain_minute_18') | float(none) +
             states('input_number.rain_minute_19') | float(none) +
             states('input_number.rain_minute_20') | float(none) +
             states('input_number.rain_minute_21') | float(none) +
             states('input_number.rain_minute_22') | float(none) +
             states('input_number.rain_minute_23') | float(none) +
             states('input_number.rain_minute_24') | float(none) +
             states('input_number.rain_minute_25') | float(none) +
             states('input_number.rain_minute_26') | float(none) +
             states('input_number.rain_minute_27') | float(none) +
             states('input_number.rain_minute_28') | float(none) +
             states('input_number.rain_minute_29') | float(none) +
             states('input_number.rain_minute_30') | float(none) +
             states('input_number.rain_minute_31') | float(none) +
             states('input_number.rain_minute_32') | float(none) +
             states('input_number.rain_minute_33') | float(none) +
             states('input_number.rain_minute_34') | float(none) +
             states('input_number.rain_minute_35') | float(none) +
             states('input_number.rain_minute_36') | float(none) +
             states('input_number.rain_minute_37') | float(none) +
             states('input_number.rain_minute_38') | float(none) +
             states('input_number.rain_minute_39') | float(none) +
             states('input_number.rain_minute_40') | float(none) +
             states('input_number.rain_minute_41') | float(none) +
             states('input_number.rain_minute_42') | float(none) +
             states('input_number.rain_minute_43') | float(none) +
             states('input_number.rain_minute_44') | float(none) +
             states('input_number.rain_minute_45') | float(none) +
             states('input_number.rain_minute_46') | float(none) +
             states('input_number.rain_minute_47') | float(none) +
             states('input_number.rain_minute_48') | float(none) +
             states('input_number.rain_minute_49') | float(none) +
             states('input_number.rain_minute_50') | float(none) +
             states('input_number.rain_minute_51') | float(none) +
             states('input_number.rain_minute_52') | float(none) +
             states('input_number.rain_minute_53') | float(none) +
             states('input_number.rain_minute_54') | float(none) +
             states('input_number.rain_minute_55') | float(none) +
             states('input_number.rain_minute_56') | float(none) +
             states('input_number.rain_minute_57') | float(none) +
             states('input_number.rain_minute_58') | float(none) +
             states('input_number.rain_minute_59') | float) | round(2, default=none) }}
        unit_of_measurement: "in/hr"

input_number:
  last_rain_report:
    min: 0
    max: 100000
    mode: box

  rain_minute:
    min: 0
    max: 100000
    mode: box

  rain_hour:
    min: 0
    max: 100000
    mode: box

  rain_day:
    min: 0
    max: 100000
    mode: box

  rain_week:
    min: 0
    max: 100000
    mode: box

  rain_month:
    min: 0
    max: 100000
    mode: box

  rain_year:
    min: 0
    max: 100000
    mode: box

  rain_total:
    min: 0
    max: 100000
    mode: box

  rain_month_1:
    min: 0
    max: 100000
    mode: box

  rain_month_2:
    min: 0
    max: 100000
    mode: box

  rain_month_3:
    min: 0
    max: 100000
    mode: box

  rain_month_4:
    min: 0
    max: 100000
    mode: box

  rain_month_5:
    min: 0
    max: 100000
    mode: box

  rain_month_6:
    min: 0
    max: 100000
    mode: box

  rain_month_7:
    min: 0
    max: 100000
    mode: box

  rain_month_8:
    min: 0
    max: 100000
    mode: box

  rain_month_9:
    min: 0
    max: 100000
    mode: box

  rain_month_10:
    min: 0
    max: 100000
    mode: box

  rain_month_11:
    min: 0
    max: 100000
    mode: box

  rain_month_12:
    min: 0
    max: 100000
    mode: box

  rain_minute_00:
    min: 0
    max: 100000
    mode: box

  rain_minute_01:
    min: 0
    max: 100000
    mode: box

  rain_minute_02:
    min: 0
    max: 100000
    mode: box

  rain_minute_03:
    min: 0
    max: 100000
    mode: box

  rain_minute_04:
    min: 0
    max: 100000
    mode: box

  rain_minute_05:
    min: 0
    max: 100000
    mode: box

  rain_minute_06:
    min: 0
    max: 100000
    mode: box

  rain_minute_07:
    min: 0
    max: 100000
    mode: box

  rain_minute_08:
    min: 0
    max: 100000
    mode: box

  rain_minute_09:
    min: 0
    max: 100000
    mode: box

  rain_minute_10:
    min: 0
    max: 100000
    mode: box

  rain_minute_11:
    min: 0
    max: 100000
    mode: box

  rain_minute_12:
    min: 0
    max: 100000
    mode: box

  rain_minute_13:
    min: 0
    max: 100000
    mode: box

  rain_minute_14:
    min: 0
    max: 100000
    mode: box

  rain_minute_15:
    min: 0
    max: 100000
    mode: box

  rain_minute_16:
    min: 0
    max: 100000
    mode: box

  rain_minute_17:
    min: 0
    max: 100000
    mode: box

  rain_minute_18:
    min: 0
    max: 100000
    mode: box

  rain_minute_19:
    min: 0
    max: 100000
    mode: box

  rain_minute_20:
    min: 0
    max: 100000
    mode: box

  rain_minute_21:
    min: 0
    max: 100000
    mode: box

  rain_minute_22:
    min: 0
    max: 100000
    mode: box

  rain_minute_23:
    min: 0
    max: 100000
    mode: box

  rain_minute_24:
    min: 0
    max: 100000
    mode: box

  rain_minute_25:
    min: 0
    max: 100000
    mode: box

  rain_minute_26:
    min: 0
    max: 100000
    mode: box

  rain_minute_27:
    min: 0
    max: 100000
    mode: box

  rain_minute_28:
    min: 0
    max: 100000
    mode: box

  rain_minute_29:
    min: 0
    max: 100000
    mode: box

  rain_minute_30:
    min: 0
    max: 100000
    mode: box

  rain_minute_31:
    min: 0
    max: 100000
    mode: box

  rain_minute_32:
    min: 0
    max: 100000
    mode: box

  rain_minute_33:
    min: 0
    max: 100000
    mode: box

  rain_minute_34:
    min: 0
    max: 100000
    mode: box

  rain_minute_35:
    min: 0
    max: 100000
    mode: box

  rain_minute_36:
    min: 0
    max: 100000
    mode: box

  rain_minute_37:
    min: 0
    max: 100000
    mode: box

  rain_minute_38:
    min: 0
    max: 100000
    mode: box

  rain_minute_39:
    min: 0
    max: 100000
    mode: box

  rain_minute_40:
    min: 0
    max: 100000
    mode: box

  rain_minute_41:
    min: 0
    max: 100000
    mode: box

  rain_minute_42:
    min: 0
    max: 100000
    mode: box

  rain_minute_43:
    min: 0
    max: 100000
    mode: box

  rain_minute_44:
    min: 0
    max: 100000
    mode: box

  rain_minute_45:
    min: 0
    max: 100000
    mode: box

  rain_minute_46:
    min: 0
    max: 100000
    mode: box

  rain_minute_47:
    min: 0
    max: 100000
    mode: box

  rain_minute_48:
    min: 0
    max: 100000
    mode: box

  rain_minute_49:
    min: 0
    max: 100000
    mode: box

  rain_minute_50:
    min: 0
    max: 100000
    mode: box

  rain_minute_51:
    min: 0
    max: 100000
    mode: box

  rain_minute_52:
    min: 0
    max: 100000
    mode: box

  rain_minute_53:
    min: 0
    max: 100000
    mode: box

  rain_minute_54:
    min: 0
    max: 100000
    mode: box

  rain_minute_55:
    min: 0
    max: 100000
    mode: box

  rain_minute_56:
    min: 0
    max: 100000
    mode: box

  rain_minute_57:
    min: 0
    max: 100000
    mode: box

  rain_minute_58:
    min: 0
    max: 100000
    mode: box

  rain_minute_59:
    min: 0
    max: 100000
    mode: box

  rain_last_minute:
    min: 0
    max: 100000
    mode: box

  rain_last_hour:
    min: 0
    max: 100000
    mode: box

  rain_last_day:
    min: 0
    max: 100000
    mode: box

  rain_last_week:
    min: 0
    max: 100000
    mode: box

  rain_last_month:
    min: 0
    max: 100000
    mode: box

  rain_last_year:
    min: 0
    max: 100000
    mode: box

  rain_last_month_1:
    min: 0
    max: 100000
    mode: box

  rain_last_month_2:
    min: 0
    max: 100000
    mode: box

  rain_last_month_3:
    min: 0
    max: 100000
    mode: box

  rain_last_month_4:
    min: 0
    max: 100000
    mode: box

  rain_last_month_5:
    min: 0
    max: 100000
    mode: box

  rain_last_month_6:
    min: 0
    max: 100000
    mode: box

  rain_last_month_7:
    min: 0
    max: 100000
    mode: box

  rain_last_month_8:
    min: 0
    max: 100000
    mode: box

  rain_last_month_9:
    min: 0
    max: 100000
    mode: box

  rain_last_month_10:
    min: 0
    max: 100000
    mode: box

  rain_last_month_11:
    min: 0
    max: 100000
    mode: box

  rain_last_month_12:
    min: 0
    max: 100000
    mode: box  
  
  rain_disable_time:
    name: Rain Gauge Disable Time
    min: 1
    max: 24
    step: 1
    unit_of_measurement: h

input_boolean:
  rain_enabled:
    name: Rain Gauge Enabled

input_text:
  last_rain:
    name: Last Rain Date

timer:
  rainfall:
    name: Rainfall Timer
    duration: "00:10:00"

  rain_disable:
    name: Rain Gauge Auto-restart Timer
    icon: mdi:timer-outline

automation:
  - alias: Count Rainfall
    id: 8ce7d087-5228-4f91-814e-daf2593793bc
    trigger:
      - platform: state
        entity_id: sensor.acurite_cumulative_rain
    action:
      - choose:
        - conditions:
          - condition: template
            value_template: "{{ ((states('sensor.acurite_cumulative_rain') | float(none) - states('input_number.last_rain_report') | float(none)) > 0) and ((states('sensor.acurite_cumulative_rain') | float(none) - states('input_number.last_rain_report') | float(none)) < 38) and is_state('input_boolean.rain_disabled', 'on') }}"
          sequence:
            - service: input_number.set_value
              entity_id: input_number.rain_minute
              data_template:
                value: "{{ states('input_number.rain_minute') | float(none) + (states('sensor.acurite_cumulative_rain') | float(none) - states('input_number.last_rain_report') | float(none)) }}"

            - service: input_number.set_value
              entity_id: input_number.rain_hour
              data_template:
                value: "{{ states('input_number.rain_hour') | float(none) + (states('sensor.acurite_cumulative_rain') | float(none) - states('input_number.last_rain_report') | float(none)) }}"

            - service: input_number.set_value
              entity_id: input_number.rain_day
              data_template:
                value: "{{ states('input_number.rain_day') | float(none) + (states('sensor.acurite_cumulative_rain') | float(none) - states('input_number.last_rain_report') | float(none)) }}"

            - service: input_number.set_value
              entity_id: input_number.rain_week
              data_template:
                value: "{{ states('input_number.rain_week') | float(none) + (states('sensor.acurite_cumulative_rain') | float(none) - states('input_number.last_rain_report') | float(none)) }}"

            - service: input_number.set_value
              entity_id: input_number.rain_month
              data_template:
                value: "{{ states('input_number.rain_month') | float(none) + (states('sensor.acurite_cumulative_rain') | float(none) - states('input_number.last_rain_report') | float(none)) }}"

            - service: input_number.set_value
              entity_id: input_number.rain_year
              data_template:
                value: "{{ states('input_number.rain_year') | float(none) + (states('sensor.acurite_cumulative_rain') | float(none) - states('input_number.last_rain_report') | float(none)) }}"

            - service: input_number.set_value
              entity_id: input_number.rain_total
              data_template:
                value: "{{ states('input_number.rain_total') | float(none) + (states('sensor.acurite_cumulative_rain') | float(none) - states('input_number.last_rain_report') | float(none)) }}"
              

            - service: input_number.set_value
              data_template:
                entity_id: >
                  input_number.rain_month_{{ now().month }}
                value: "{{ states('input_number.rain_month') | float(none) }}"

            - service: input_number.set_value
              data_template:
                entity_id: >
                  {% if  now().minute < 10 -%}
                    input_number.rain_minute_0{{ now().minute }}
                  {% else -%}
                    input_number.rain_minute_{{ now().minute }}
                  {% endif -%}
                value: "{{ ((states('input_number.rain_minute') | float(none)) / 25.4) | round(2, default=none) }}"

            - service: input_text.set_value
              entity_id: input_text.last_rain
              data_template:
                value: "{{ now() }}"

            - service: input_boolean.turn_on
              entity_id: input_boolean.is_raining

            - service: timer.start
              entity_id: timer.rainfall

      - service: input_number.set_value
        entity_id: input_number.last_rain_report
        data_template:
          value: "{{ states('sensor.acurite_cumulative_rain') | float(none) }}"

  - alias: Reset Minute Rain
    id: d2d6a4b7-7b33-4b1b-9d70-1540038f045f
    trigger:
      - platform: time_pattern
        minutes: "*"
        seconds: "0"
    action:
      - service: input_number.set_value
        data_template:
          entity_id: >
            {% if now().minute == 0 -%}
              input_number.rain_minute_59
            {% elif  now().minute <= 10 -%}
              input_number.rain_minute_0{{ now().minute - 1 }}
            {% else -%}
              input_number.rain_minute_{{ now().minute - 1 }}
            {% endif -%}
          value: "{{ states('sensor.rain_minute') }}"
      - service: input_number.set_value
        entity_id: input_number.rain_last_minute
        data_template:
          value: "{{ states('input_number.rain_minute') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.rain_minute
        data:
          value: 0

  - alias: Reset Hour Rain
    id: 0909cbad-812d-491a-95aa-e3657016e3b5
    trigger:
      - platform: time_pattern
        hours: "*"
        minutes: "0"
        seconds: "0"
    action:
      - service: input_number.set_value
        entity_id: input_number.rain_last_hour
        data_template:
          value: "{{ states('input_number.rain_hour') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.rain_hour
        data:
          value: 0

  - alias: Reset Day Rain
    id: ba13862e-30fa-4ccd-9dc8-8c5ed6dcd6b1
    trigger:
      - platform: time
        at: "00:00:00"
    action:
      - service: input_number.set_value
        entity_id: input_number.rain_last_day
        data_template:
          value: "{{ states('input_number.rain_day') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.rain_day
        data:
          value: 0

  - alias: Reset Week Rain
    id: 4b0a2f98-584f-49b7-bea8-1e8f0d1fd6ce
    trigger:
      - platform: time
        at: "00:00:00"
    condition:
      - condition: template
        value_template: "{{ now().weekday() == 0 }}"
    action:
      - service: input_number.set_value
        entity_id: input_number.rain_last_week
        data_template:
          value: "{{ states('input_number.rain_week') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.rain_week
        data:
          value: 0

  - alias: Reset Month Rain
    id: cddeb882-47f2-45c0-b853-80ac795ccf54
    trigger:
      - platform: time
        at: "00:00:00"
    condition:
      - condition: template
        value_template: "{{ now().day == 1 }}"
    action:
      - service: input_number.set_value
        entity_id: input_number.rain_last_month
        data_template:
          value: "{{ states('input_number.rain_month') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.rain_month
        data:
          value: 0
##
  - alias: Reset Year Rain
    id: f7dd2199-f7db-4786-8488-7219521d2cff
    trigger:
      - platform: time
        at: "00:00:00"
    condition:
      - condition: template
        value_template: "{{ now().month == 1 }}"
      - condition: template
        value_template: "{{ now().day == 1 }}"
    action:
      - service: input_number.set_value
        entity_id: input_number.rain_last_year
        data_template:
          value: "{{ states('input_number.rain_year') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.rain_last_month_1
        data_template:
          value: "{{ states('input_number.rain_month_1') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.rain_last_month_2
        data_template:
          value: "{{ states('input_number.rain_month_2') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.rain_last_month_3
        data_template:
          value: "{{ states('input_number.rain_month_3') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.rain_last_month_4
        data_template:
          value: "{{ states('input_number.rain_month_4') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.rain_last_month_5
        data_template:
          value: "{{ states('input_number.rain_month_5') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.rain_last_month_6
        data_template:
          value: "{{ states('input_number.rain_month_6') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.rain_last_month_7
        data_template:
          value: "{{ states('input_number.rain_month_7') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.rain_last_month_8
        data_template:
          value: "{{ states('input_number.rain_month_8') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.rain_last_month_9
        data_template:
          value: "{{ states('input_number.rain_month_9') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.rain_last_month_10
        data_template:
          value: "{{ states('input_number.rain_month_10') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.rain_last_month_11
        data_template:
          value: "{{ states('input_number.rain_month_11') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.rain_last_month_12
        data_template:
          value: "{{ states('input_number.rain_month_12') | float(none) }}"
      - service: input_number.set_value
        entity_id: 
          - input_number.rain_year
          - input_number.rain_month_1
          - input_number.rain_month_2
          - input_number.rain_month_3
          - input_number.rain_month_4
          - input_number.rain_month_5
          - input_number.rain_month_6
          - input_number.rain_month_7
          - input_number.rain_month_8
          - input_number.rain_month_9
          - input_number.rain_month_10
          - input_number.rain_month_11
          - input_number.rain_month_12
        data:
          value: 0     

  - alias: Detect Rain Started
    id: 40401945-a472-4593-be28-83fca5d5346a
    trigger:
      - platform: state
        entity_id: input_boolean.is_raining
        from: "off"
        to: "on"
    action:
      - service: browser_mod.toast
        data:
          message: "It is now raining."
          duration: 3000

  - alias: Detect Rain Stopped
    id: 57665748-7cf8-4772-8b4f-e62180061328
    trigger:
      - event_data:
          entity_id: timer.rainfall
        event_type: timer.finished
        platform: event
    action:
      - service: input_boolean.turn_off
        entity_id: input_boolean.is_raining
      - service: browser_mod.toast
        data:
          message: "It has stopped raining."
          duration: 3000

  - alias: Display Rainfall on Elk Keypads
    id: 685fd76c-0b0a-470d-811f-85f320b041e9
    trigger:
      - platform: state
        entity_id: sensor.rain_day
      - platform: state
        entity_id: alarm_control_panel.house
        to: disarmed
      - platform: state
        entity_id: alarm_control_panel.house
        from: arming
        to: armed_home
      - platform: state
        entity_id: alarm_control_panel.house
        from: arming
        to: armed_night
      - platform: state
        entity_id: alarm_control_panel.house
        from: 
          - disarmed
          - armed_night
        to: armed_home
        for: "00:01:00"
      - platform: state
        entity_id: alarm_control_panel.house
        from: 
          - disarmed
          - armed_home
        to: armed_night
        for: "00:01:00"
    condition:
      - condition: template
        value_template: "{{ states('sensor.rain_day') | float(none) > 0 }}"
    action:
      - service: elkm1.alarm_display_message
        data_template:
          entity_id: alarm_control_panel.house
          line1: 'Rain: {{ states("sensor.rain_day") }}"'

  - alias: Clear Rainfall on Elk Keypads
    id: f3c2857e-2a74-4d14-a8b4-254925d5574a
    trigger:
      - platform: template
        value_template: "{{ states('sensor.rain_day') | float(none) == 0 }}"
    action:
      - service: elkm1.alarm_display_message
        data_template:
          entity_id: alarm_control_panel.house
          clear: 0

  - alias: Start Reset Timer When Rain Gauge Disabled
    id: 121dd221-5335-4280-94c7-174e2aab9c84
    trigger:
      - platform: state
        entity_id: input_boolean.rain_enabled
        to: 'off'
    action:
      - service: timer.start
        data_template:
          entity_id: timer.rain_disable
          duration: "{{ states('input_number.rain_disable_time') | int * 3600}}"

  - alias: Restart Rain Gauge When Restart Timer Expires
    id: 5843a1ac-abc2-4ee1-a242-d5921d82ff54
    trigger:
      - event_data:
          entity_id: timer.rain_disable
        event_type: timer.finished
        platform: event
    condition:
      - condition: state
        entity_id: input_boolean.rain_enabled
        state: 'off'
    action:
      - service: input_boolean.turn_on
        entity_id: input_boolean.rain_enabled

  - alias: Cancel Rain Gauge Timer if Rain Gauge Manually Enabled
    id: 219f6e1e-261a-447c-b5c8-84acf5e2cc7e
    trigger:
      - platform: state
        entity_id: input_boolean.rain_enabled
        to: 'on'
    condition:
      - condition: state
        entity_id: timer.rain_disable
        state: 'active'
    action:
      - service: timer.cancel
        entity_id: timer.rain_disable