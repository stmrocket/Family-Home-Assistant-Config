- alias: Refresh Entity Counters
  id: 81b799f7-10d4-40c7-96c2-255ec5f4020b
  trigger:
    - platform: time_pattern
      minutes: "/15"
  action:
    - service: homeassistant.update_entity
      continue_on_error: true
      entity_id:
        - sensor.automation_count
        - sensor.binary_sensor_count
        - sensor.switch_count
        - sensor.fan_count
        - sensor.lights_count
        - sensor.tracker_count
        - sensor.media_player_count
        - sensor.script_count
        - sensor.sensor_count

- alias: "Set Theme to Midnight"
  id: 5fbf01bf-84c0-46af-8177-b09e96dad69c
  trigger:
    - platform: homeassistant
      event: start
  action:
    - service: frontend.set_theme
      data:
        name: midnight

- alias: Turn On Sound Machine
  id: 03759759-c2c7-4d9e-80c7-594b998b615a
  trigger:
    - platform: state
      entity_id: alarm_control_panel.elkm1_house
      from: disarmed
      to: armed_night
    - platform: state
      entity_id: alarm_control_panel.elkm1_house
      from: armed_home
      to: armed_night
  action:
    - service: esphome.sound_machine_master_dfplayer_play_bedtime

- alias: Turn Off Sound Machine
  id: c7b2bf10-f9f0-4ba9-9f53-21c9297ad4da
  trigger:
    - platform: state
      entity_id: alarm_control_panel.elkm1_house
      from: armed_night
      to: armed_home
    - platform: state
      entity_id: alarm_control_panel.elkm1_house
      from: armed_night
      to: disarmed
  action:
    - service: esphome.esphome.sound_machine_master_dfplayer_stop

- alias: Record HA Shutdown Time
  id: ec7e8067-739b-45c1-b950-017fa7de9b2c
  trigger:
    - platform: homeassistant
      event: shutdown
  action:
    - service: mqtt.publish
      data_template:
        topic: hass/restart
        payload: "{{ now() }}"
        retain: true
